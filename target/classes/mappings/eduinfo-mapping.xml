<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="eduinfoDAO">

	<select id="attendanceList" parameterType="com.smart.lms.util.Pagination" resultType="attendDTO">
		SELECT * FROM ATTEND_CLASS WHERE C_NUMBER = #{c_number}
		<if test="keyword != null">
			<if test="searchType == 'id'"> AND ID like CONCAT('%', #{keyword}, '%') </if>
			<if test="searchType == 'name'"> AND NAME like CONCAT('%', #{keyword}, '%') </if>
			ORDER BY ID 
			LIMIT #{sizePerPage} OFFSET #{startList}  
		</if>
	</select>
	
	<select id="attendanceTotalCnt" parameterType="com.smart.lms.util.Pagination" resultType="integer">
		SELECT COUNT(*) FROM ATTEND_CLASS WHERE C_NUMBER = #{c_number}
		<if test="keyword != null">
			<if test="searchType == 'id'"> AND ID like CONCAT('%', #{keyword}, '%')</if>
			<if test="searchType == 'name'"> AND NAME like CONCAT('%', #{keyword}, '%')</if>
		</if>
	</select>
	
	<select id="toCnt" parameterType="com.smart.lms.util.Pagination" resultType="integer">
		SELECT COUNT(*) FROM TODATE WHERE DATE(A_DATE) = DATE(#{date}) 
		<if test="keyword != null">
			<if test="searchType == 'id'"> AND ID like CONCAT('%', #{keyword}, '%')</if>
		</if>
	</select>
	
	<select id="classList" resultType="classDTO">
		SELECT * FROM CLASS WHERE C_ID = #{c_id}
	</select>
	
	<insert id = "insertAttendanceTx">
		INSERT INTO TODATE (C_NUMBER, ID, A_DATE, A_STATUS) VALUES (#{c_number}, #{id}, #{a_date}, #{a_status})
	</insert>
	
	<select id = "getTodate" parameterType="com.smart.lms.util.Pagination" resultType="todateDTO">
		SELECT *, (SELECT ac.NAME FROM ATTEND_CLASS ac WHERE C_NUMBER = #{c_number} AND ID = #{id}) 
		FROM TODATE WHERE C_NUMBER = #{c_number} AND ID = #{id} AND DATE(A_DATE) = DATE(#{a_date}) 
			<if test="keyword != null">
			<if test="searchType == 'id'"> AND ID like CONCAT('%', #{keyword}, '%') </if>
			<if test="searchType == 'name'"> AND ac.NAME like CONCAT('%', #{keyword}, '%') </if>
			ORDER BY ID 
			LIMIT #{sizePerPage} OFFSET #{startList}  
		</if>
	</select>
	
	<update id="updateAttendanceTx">
		UPDATE TODATE SET A_STATUS = #{a_status} WHERE C_NUMBER = #{c_number} AND ID = #{id} AND DATE(A_DATE) = DATE(#{a_date})
	</update>

	<insert id = "classInsertTx">
		INSERT INTO CLASS (C_NAME, C_CREATE_DATE, C_START_DATE, C_END_DATE, C_ID, C_PROF_NAME, C_STU_COUNT, C_TIME, C_INFO, C_TERM , C_DAY, C_STATUS ) 
		VALUES (#{c_name}, SYSDATE() , #{c_start_date}, #{c_end_date}, #{c_id} , #{c_prof_name}, #{c_stu_count}, #{c_time}, #{c_info}, #{c_term}, #{c_day}, '진행')
	</insert>
	
	
	<select id="classAllList" parameterType="com.smart.lms.util.Pagination" resultType="classDTO">
		SELECT * FROM CLASS WHERE C_STATUS = '진행'
		<if test="keyword != null">
			<if test="searchType == 'name'"> AND C_PROF_NAME like CONCAT('%', #{keyword}, '%') </if>
			<if test="searchType == 'c_name'"> AND C_NAME like CONCAT('%', #{keyword}, '%') </if>
			<if test="searchType == 'c_info'"> AND C_INFO like CONCAT('%', #{keyword}, '%') </if>
			ORDER BY C_NUMBER 
			LIMIT #{sizePerPage} OFFSET #{startList}  
		</if>
	</select>
	
	<select id="classAllTotalCnt" parameterType="com.smart.lms.util.Pagination" resultType="integer">
		SELECT COUNT(*) FROM CLASS WHERE C_STATUS = '진행'
		<if test="keyword != null">
			<if test="searchType == 'name'"> AND NAME like CONCAT('%', #{keyword}, '%')</if>
			<if test="searchType == 'c_name'"> AND C_NAME like CONCAT('%', #{keyword}, '%') </if>
			<if test="searchType == 'c_info'"> AND C_INFO like CONCAT('%', #{keyword}, '%')</if>
		</if>
	</select>
	
	<select id= "classSelect" resultType="classDTO">
		SELECT * FROM CLASS WHERE C_NUMBER = #{c_number} 
	</select>
	
	<update id="classUpdateTx">
		UPDATE CLASS SET C_ID = #{c_id} , C_NAME = #{c_name}, C_START_DATE = #{c_start_date} , C_END_DATE = #{c_end_date} , C_PROF_NAME = #{c_prof_name}
		, C_STU_COUNT = #{c_stu_count} , C_TIME = #{c_time} , C_INFO = #{c_info} , C_TERM = #{c_term} , C_DAY = #{c_day} , C_STATUS = #{c_status}
		WHERE C_NUMBER = #{c_number}
	</update>
	
	<select id="studentList" parameterType="com.smart.lms.util.Pagination" resultType="studentDTO">
		SELECT * FROM STUDENT WHERE 1=1
		<if test="keyword != null">
			<if test="searchType == 'id'"> AND ID like CONCAT('%', #{keyword}, '%') </if>
			<if test="searchType == 'name'"> AND NAME like CONCAT('%', #{keyword}, '%') </if>
			ORDER BY ID 
			LIMIT #{sizePerPage} OFFSET #{startList}  
		</if>
	</select>
	
	<select id="stuAllCnt" parameterType="com.smart.lms.util.Pagination" resultType="integer">
		SELECT COUNT(*) FROM STUDENT WHERE 1=1
		<if test="keyword != null">
			<if test="searchType == 'id'"> AND ID like CONCAT('%', #{keyword}, '%')</if>
			<if test="searchType == 'name'"> AND NAME like CONCAT('%', #{keyword}, '%')</if>
		</if>
	</select>
	
	<select id="proList" parameterType="com.smart.lms.util.Pagination" resultType="professorDTO">
		SELECT * FROM PROFESSOR WHERE 1=1
		<if test="keyword != null">
			<if test="searchType == 'id'"> AND ID like CONCAT('%', #{keyword}, '%') </if>
			<if test="searchType == 'name'"> AND NAME like CONCAT('%', #{keyword}, '%') </if>
			ORDER BY ID 
			LIMIT #{sizePerPage} OFFSET #{startList}  
		</if>
	</select>
	
	<select id="proAllCnt" parameterType="com.smart.lms.util.Pagination" resultType="integer">
		SELECT COUNT(*) FROM PROFESSOR WHERE 1=1
		<if test="keyword != null">
			<if test="searchType == 'id'"> AND ID like CONCAT('%', #{keyword}, '%')</if>
			<if test="searchType == 'name'"> AND NAME like CONCAT('%', #{keyword}, '%')</if>
		</if>
	</select>
	
	<select id="stuInfo"  resultType="StudentDTO">
		SELECT * FROM STUDENT ID = #{id}
	</select>
	

</mapper>