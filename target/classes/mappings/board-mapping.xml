<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boardDAO">

<insert id="sendNote"> 
INSERT INTO NOTE(N_SENDER, N_RECIVER, N_TITLE, N_INFO, N_SEND_DATE) 
VALUES(#{n_sender}, #{n_reciver}, #{n_title}, #{n_info}, SYSDATE()) 
</insert>
<select id="receivNote" resultType="noteDTO"> 
select * from note
</select>

<select id="getSearchNotesWithPagination" parameterType="map" resultType="noteDTO">
SELECT *
FROM note
WHERE (n_title LIKE CONCAT('%', #{search}, '%')
       OR n_sender LIKE CONCAT('%', #{search}, '%'))
  AND n_reciver = #{userId}
ORDER BY n_number DESC
LIMIT #{start}, #{size}

</select>

<!-- <select id="getSearchNotesWithPagination"  parameterType="com.smart.lms.util.Pagination" resultType="noteDTO"> -->
<!--    SELECT * -->
<!--     FROM note -->
<!--     WHERE n_title LIKE CONCAT('%', #{keyword}, '%') -->
<!--        OR n_sender LIKE CONCAT('%', #{keyword}, '%') -->
<!--        ORDER BY n_number DESC -->
<!--     LIMIT #{sizePerPage} OFFSET #{startList}   -->
<!-- </select> -->

<select id="detailNote" resultType="noteDTO">
select * from note where n_number = #{n_number}
</select>

<select id="getNotesWithPagination" parameterType="map" resultType="noteDTO">
    SELECT * FROM note
    where N_RECIVER = #{userId}
    ORDER BY n_number DESC
    LIMIT #{start}, #{size}
</select>

<select id="getTotalNoteCount" resultType="integer">
    SELECT COUNT(*) FROM note where n_reciver = #{userId}
</select>

<select id="getSearchTotalNoteCount" resultType="integer">
SELECT COUNT(*)
FROM note
WHERE (n_title LIKE CONCAT('%', #{search}, '%')
       OR n_sender LIKE CONCAT('%', #{search}, '%'))
  AND n_reciver = #{userId}

</select>

<update id="updateNote">
    UPDATE note
    SET N_RECIVE_DATE = SYSDATE()
    WHERE N_NUMBER = #{n_number}
    AND N_RECIVE_DATE IS NULL
</update>

<delete id="deleteNote">
delete from note where n_number = #{n_number}
</delete>
</mapper>