<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boardDAO">

	<insert id="sendNote">
		INSERT INTO NOTE(N_SENDER, N_RECIVER, N_TITLE, N_INFO, N_SEND_DATE)
		VALUES(#{n_sender}, #{n_reciver}, #{n_title}, #{n_info}, SYSDATE())
	</insert>
	<select id="receivNote" resultType="noteDTO">
		select * from note
	</select>

	<select id="getSearchNotesWithPagination" parameterType="map"
		resultType="noteDTO">
		SELECT *
		FROM note
		WHERE (n_title LIKE CONCAT('%', #{search}, '%')
		OR n_sender LIKE CONCAT('%', #{search}, '%'))
		AND n_reciver = #{userId}
		ORDER BY n_number DESC
		LIMIT #{start}, #{size}

	</select>

	<select id="getBoardList" resultType="BoardDTO">
		SELECT * FROM BOARD WHERE
		B_TYPE = #{b_type}
	</select>

	<insert id="insertBoard">
		INSERT INTO BOARD(B_TARGET, B_TITLE, B_INFO, B_WRITER, B_TYPE,
		B_CREATE_DATE) VALUES(#{b_target}, #{b_title}, #{b_info}, #{b_writer},
		#{b_type}, SYSDATE())
	</insert>

	<select id="getBoard" resultType="BoardDTO">
		SELECT * FROM BOARD WHERE
		B_NUMBER = #{b_number}
	</select>

	<delete id="deleteBoard">
		DELETE FROM BOARD WHERE B_NUMBER = #{b_number}
	</delete>

	<update id="updateBoard">
		UPDATE BOARD SET B_TITLE = #{b_title}, B_INFO = #{b_info} WHERE B_NUMBER =
		#{b_number}
	</update>

	<select id="detailNote" resultType="noteDTO">
		select * from note where n_number = #{n_number}
	</select>

	<select id="getNotesWithPagination" parameterType="map"
		resultType="noteDTO">
		SELECT * FROM note
		where N_RECIVER = #{userId}
		ORDER BY n_number DESC
		LIMIT #{start}, #{size}
	</select>

	<select id="getTotalNoteCount" resultType="integer">
		SELECT COUNT(*) FROM note where n_reciver = #{userId}
	</select>

	<select id="getSearchTotalNoteCount" resultType="integer">
		SELECT COUNT(*)
		FROM note
		WHERE (n_title LIKE CONCAT('%', #{search}, '%')
		OR n_sender LIKE CONCAT('%', #{search}, '%'))
		AND n_reciver = #{userId}

	</select>

	<update id="updateNote">
		UPDATE note
		SET N_RECIVE_DATE = SYSDATE()
		WHERE N_NUMBER = #{n_number}
		AND N_RECIVE_DATE IS NULL
	</update>

	<delete id="deleteNote">
		delete from note where n_number = #{n_number}
	</delete>
	
	<select id="checkUser" resultType="StudentDTO">
		select * from student where id = #{n_reciver}
	</select>
	
	<select id="noteCount" resultType="integer">
	select count(*) from note where N_RECIVER  = #{userId} and N_RECIVE_DATE is null;
	</select>
</mapper>